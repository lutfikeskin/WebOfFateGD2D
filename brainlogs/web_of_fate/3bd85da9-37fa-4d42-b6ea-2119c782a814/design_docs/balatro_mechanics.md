# Design Doc: The "Web of Fate" Balatro-fication

To achieve the addictive, "number-go-up" feel of Balatro, we need to overhaul three core pillars: **The Math**, **The Flow**, and **The Juice**.

## 1. The Math: Base Ã— Mult
Balatro's core hook is the interaction between "Chips" (additive) and "Mult" (multiplicative). We will adapt this to Web of Fate.

### New Formula
Instead of just summing up Legacy points, we will calculate:

$$ \text{Score} = (\sum \text{Base Legacy}) \times (\prod \text{Multipliers}) $$

### Components
1.  **Base Legacy (The "Chips")**:
    *   Generated by Card Stats (e.g., "Faultline gives 20 Legacy").
    *   Boosted by "Flat Bonuses" (e.g., "+10 Base Legacy to all Danger cards").
    *   *Feel*: This is your foundation. You need a solid base to multiply.

2.  **The Multiplier (The "Mult")**:
    *   Starts at **1.0x**.
    *   **Card Multipliers**: "x1.5 Mult if placed in Corner".
    *   **Combo Multipliers**: "Row Synergy: x1.2 Mult".
    *   **Global Multipliers**: "Chaos Level 50: x2.0 Mult".
    *   *Feel*: This is where the explosion happens. Stacking multipliers is the key to high scores.

3.  **The "Retrigger"**:
    *   Mechanic: "Trigger this card again".
    *   Example: A "Time Warp" card that makes the previous card resolve a second time, adding its Base Legacy *and* applying its Multiplier again.

## 2. The Flow: Step-by-Step Resolution
Currently, `SpreadResolver` calculates everything instantly. To get the "watching them calculate" feel, we must slow it down and visualize each step.

### New Resolution Sequence (Coroutine)
1.  **Start**: Show initial Score (0).
2.  **Card 1 (TL) Resolves**:
    *   *Animation*: Card flashes.
    *   *Math*: Base Legacy is added to pool. `Score += 20`.
    *   *Visual*: Number pops up and flies to Score Counter.
    *   *Sound*: "Ding" (Pitch 1.0).
3.  **Card 2 (TR) Resolves**:
    *   *Animation*: Card flashes.
    *   *Math*: Base Legacy added.
    *   *Sound*: "Ding" (Pitch 1.1).
4.  **Combo Detected!**:
    *   *Animation*: Line drawn between TL and TR. Fire particles!
    *   *Math*: **Multiplier increases**. `Mult x 1.5`.
    *   *Visual*: Multiplier text shakes and grows.
    *   *Sound*: Heavy "Thud" or "Chime".
5.  **...Repeat for BL and BR...**
6.  **Final Tally**:
    *   Apply Global Multipliers (Chaos).
    *   *Visual*: Screen shake. Score counts up rapidly to final total.

## 3. The Juice: Visual & Audio Feedback
*   **Dynamic Score Counter**: Don't just set text. Lerp the number. `99... 100... 150... 500!`.
*   **Screen Shake**: Small shake on card resolve, medium shake on combo, massive shake on Level Up or High Score.
*   **Particles**:
    *   **Sparks**: When adding Base Legacy.
    *   **Fire/Explosion**: When increasing Multiplier.
*   **Audio**:
    *   Rising pitch for consecutive successes.
    *   Bass-heavy sound for Multiplier increases.

## Implementation Plan

### Phase 1: The Engine (Math)
1.  Refactor `SpreadResolver.gd` to use the `Base * Mult` formula.
2.  Add `base_bonus` and `mult_bonus` fields to `CardData` and `ComboData`.

### Phase 2: The Pipeline (Async)
1.  Change `resolve_spread` to be an `async` function (using `await`).
2.  Emit signals for each "micro-step": `card_resolved`, `combo_triggered`, `mult_increased`.

### Phase 3: The Display (UI)
1.  Create a `ScoreDisplay` widget with `Base` and `Mult` labels.
2.  Connect to `SpreadResolver` signals to animate numbers.
3.  Add "Juice" (Tween animations, particles).

## Example Scenario
*   **Hand**: [Faultline (20 Base)] [Twinflame (15 Base, x1.5 Pair)]
*   **Action**:
    1.  Faultline resolves: **Base = 20**. Score = 20.
    2.  Twinflame resolves: **Base += 15** (Total 35). Score = 35.
    3.  Twinflame Effect: **Mult x 1.5**.
    4.  **Final Calculation**: 35 * 1.5 = **52.5**.
*   **Result**: The player sees the Base grow (20 -> 35), then sees the Mult slam down (x1.5), and the final score jump.
